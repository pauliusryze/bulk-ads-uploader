{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect } from 'react';\nimport FacebookAPIClient from '../lib/facebook-api';\nexport const useFacebookAuth = () => {\n  _s();\n  const [authState, setAuthState] = useState({\n    isAuthenticated: false,\n    accessToken: null,\n    adAccounts: [],\n    pages: [],\n    selectedAdAccount: null,\n    selectedPage: null,\n    customAudiences: [],\n    isLoading: false,\n    error: null\n  });\n  const [apiClient, setApiClient] = useState(null);\n\n  // Initialize Facebook SDK\n  useEffect(() => {\n    const initFacebookSDK = () => {\n      if (window.FB) {\n        window.FB.init({\n          appId: process.env.REACT_APP_FACEBOOK_APP_ID || 'your-app-id',\n          cookie: true,\n          xfbml: true,\n          version: 'v18.0'\n        });\n      }\n    };\n\n    // Load Facebook SDK\n    if (!window.FB) {\n      const script = document.createElement('script');\n      script.src = 'https://connect.facebook.net/en_US/sdk.js';\n      script.async = true;\n      script.defer = true;\n      script.crossOrigin = 'anonymous';\n      script.onload = initFacebookSDK;\n      document.head.appendChild(script);\n    } else {\n      initFacebookSDK();\n    }\n  }, []);\n\n  // Facebook Login\n  const login = async () => {\n    setAuthState(prev => ({\n      ...prev,\n      isLoading: true,\n      error: null\n    }));\n    try {\n      const response = await new Promise((resolve, reject) => {\n        window.FB.login(response => {\n          if (response.authResponse) {\n            resolve(response);\n          } else {\n            reject(new Error('Facebook login failed'));\n          }\n        }, {\n          scope: 'ads_management,pages_read_engagement,pages_manage_ads',\n          return_scopes: true\n        });\n      });\n      const {\n        accessToken\n      } = response.authResponse;\n\n      // Initialize API client\n      const client = new FacebookAPIClient({\n        appId: process.env.REACT_APP_FACEBOOK_APP_ID || 'your-app-id',\n        accessToken,\n        adAccountId: '',\n        // Will be set when user selects an ad account\n        sandboxMode: true // Start in sandbox mode for safety\n      });\n      setApiClient(client);\n\n      // Get user's ad accounts and pages\n      const [adAccountsResponse, pagesResponse] = await Promise.all([client.getAdAccounts(), client.getPages()]);\n      setAuthState(prev => ({\n        ...prev,\n        isAuthenticated: true,\n        accessToken,\n        adAccounts: adAccountsResponse.data,\n        pages: pagesResponse.data,\n        isLoading: false\n      }));\n    } catch (error) {\n      setAuthState(prev => ({\n        ...prev,\n        isLoading: false,\n        error: error instanceof Error ? error.message : 'Login failed'\n      }));\n    }\n  };\n\n  // Logout\n  const logout = () => {\n    window.FB.logout(() => {\n      setAuthState({\n        isAuthenticated: false,\n        accessToken: null,\n        adAccounts: [],\n        pages: [],\n        selectedAdAccount: null,\n        selectedPage: null,\n        customAudiences: [],\n        isLoading: false,\n        error: null\n      });\n      setApiClient(null);\n    });\n  };\n\n  // Select ad account\n  const selectAdAccount = async adAccount => {\n    if (!apiClient) return;\n    setAuthState(prev => ({\n      ...prev,\n      isLoading: true,\n      error: null\n    }));\n    try {\n      // Update API client with selected ad account\n      const updatedClient = new FacebookAPIClient({\n        appId: process.env.REACT_APP_FACEBOOK_APP_ID || 'your-app-id',\n        accessToken: authState.accessToken,\n        adAccountId: adAccount.id,\n        sandboxMode: true\n      });\n      setApiClient(updatedClient);\n\n      // Get custom audiences for this ad account\n      const customAudiencesResponse = await updatedClient.getCustomAudiences(adAccount.id);\n      setAuthState(prev => ({\n        ...prev,\n        selectedAdAccount: adAccount,\n        customAudiences: customAudiencesResponse.data,\n        isLoading: false\n      }));\n    } catch (error) {\n      setAuthState(prev => ({\n        ...prev,\n        isLoading: false,\n        error: error instanceof Error ? error.message : 'Failed to load ad account data'\n      }));\n    }\n  };\n\n  // Select page\n  const selectPage = page => {\n    setAuthState(prev => ({\n      ...prev,\n      selectedPage: page\n    }));\n  };\n  return {\n    ...authState,\n    apiClient,\n    login,\n    logout,\n    selectAdAccount,\n    selectPage\n  };\n};\n_s(useFacebookAuth, \"osScM2MJDbVa1NbNRxs16Akdf40=\");","map":{"version":3,"names":["useState","useEffect","FacebookAPIClient","useFacebookAuth","_s","authState","setAuthState","isAuthenticated","accessToken","adAccounts","pages","selectedAdAccount","selectedPage","customAudiences","isLoading","error","apiClient","setApiClient","initFacebookSDK","window","FB","init","appId","process","env","REACT_APP_FACEBOOK_APP_ID","cookie","xfbml","version","script","document","createElement","src","async","defer","crossOrigin","onload","head","appendChild","login","prev","response","Promise","resolve","reject","authResponse","Error","scope","return_scopes","client","adAccountId","sandboxMode","adAccountsResponse","pagesResponse","all","getAdAccounts","getPages","data","message","logout","selectAdAccount","adAccount","updatedClient","id","customAudiencesResponse","getCustomAudiences","selectPage","page"],"sources":["/Users/paulius/Downloads/Projects/Meta Ads Uploader/frontend/src/hooks/useFacebookAuth.ts"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport FacebookAPIClient, { \n  FacebookAPIConfig, \n  FacebookAdAccount, \n  FacebookPage,\n  FacebookCustomAudience \n} from '../lib/facebook-api';\nimport { FacebookAuthResponse } from '../types/facebook';\n\nexport interface FacebookAuthState {\n  isAuthenticated: boolean;\n  accessToken: string | null;\n  adAccounts: FacebookAdAccount[];\n  pages: FacebookPage[];\n  selectedAdAccount: FacebookAdAccount | null;\n  selectedPage: FacebookPage | null;\n  customAudiences: FacebookCustomAudience[];\n  isLoading: boolean;\n  error: string | null;\n}\n\nexport const useFacebookAuth = () => {\n  const [authState, setAuthState] = useState<FacebookAuthState>({\n    isAuthenticated: false,\n    accessToken: null,\n    adAccounts: [],\n    pages: [],\n    selectedAdAccount: null,\n    selectedPage: null,\n    customAudiences: [],\n    isLoading: false,\n    error: null,\n  });\n\n  const [apiClient, setApiClient] = useState<FacebookAPIClient | null>(null);\n\n  // Initialize Facebook SDK\n  useEffect(() => {\n    const initFacebookSDK = () => {\n      if (window.FB) {\n        window.FB.init({\n          appId: process.env.REACT_APP_FACEBOOK_APP_ID || 'your-app-id',\n          cookie: true,\n          xfbml: true,\n          version: 'v18.0',\n        });\n      }\n    };\n\n    // Load Facebook SDK\n    if (!window.FB) {\n      const script = document.createElement('script');\n      script.src = 'https://connect.facebook.net/en_US/sdk.js';\n      script.async = true;\n      script.defer = true;\n      script.crossOrigin = 'anonymous';\n      script.onload = initFacebookSDK;\n      document.head.appendChild(script);\n    } else {\n      initFacebookSDK();\n    }\n  }, []);\n\n  // Facebook Login\n  const login = async (): Promise<void> => {\n    setAuthState(prev => ({ ...prev, isLoading: true, error: null }));\n\n    try {\n      const response = await new Promise<{ authResponse: { accessToken: string } }>((resolve, reject) => {\n        window.FB.login((response) => {\n          if (response.authResponse) {\n            resolve(response as { authResponse: { accessToken: string } });\n          } else {\n            reject(new Error('Facebook login failed'));\n          }\n        }, {\n          scope: 'ads_management,pages_read_engagement,pages_manage_ads',\n          return_scopes: true,\n        });\n      });\n\n      const { accessToken } = response.authResponse;\n      \n      // Initialize API client\n      const client = new FacebookAPIClient({\n        appId: process.env.REACT_APP_FACEBOOK_APP_ID || 'your-app-id',\n        accessToken,\n        adAccountId: '', // Will be set when user selects an ad account\n        sandboxMode: true, // Start in sandbox mode for safety\n      });\n\n      setApiClient(client);\n\n      // Get user's ad accounts and pages\n      const [adAccountsResponse, pagesResponse] = await Promise.all([\n        client.getAdAccounts(),\n        client.getPages(),\n      ]);\n\n      setAuthState(prev => ({\n        ...prev,\n        isAuthenticated: true,\n        accessToken,\n        adAccounts: adAccountsResponse.data,\n        pages: pagesResponse.data,\n        isLoading: false,\n      }));\n\n    } catch (error) {\n      setAuthState(prev => ({\n        ...prev,\n        isLoading: false,\n        error: error instanceof Error ? error.message : 'Login failed',\n      }));\n    }\n  };\n\n  // Logout\n  const logout = (): void => {\n    window.FB.logout(() => {\n      setAuthState({\n        isAuthenticated: false,\n        accessToken: null,\n        adAccounts: [],\n        pages: [],\n        selectedAdAccount: null,\n        selectedPage: null,\n        customAudiences: [],\n        isLoading: false,\n        error: null,\n      });\n      setApiClient(null);\n    });\n  };\n\n  // Select ad account\n  const selectAdAccount = async (adAccount: FacebookAdAccount): Promise<void> => {\n    if (!apiClient) return;\n\n    setAuthState(prev => ({ ...prev, isLoading: true, error: null }));\n\n    try {\n      // Update API client with selected ad account\n      const updatedClient = new FacebookAPIClient({\n        appId: process.env.REACT_APP_FACEBOOK_APP_ID || 'your-app-id',\n        accessToken: authState.accessToken!,\n        adAccountId: adAccount.id,\n        sandboxMode: true,\n      });\n\n      setApiClient(updatedClient);\n\n      // Get custom audiences for this ad account\n      const customAudiencesResponse = await updatedClient.getCustomAudiences(adAccount.id);\n\n      setAuthState(prev => ({\n        ...prev,\n        selectedAdAccount: adAccount,\n        customAudiences: customAudiencesResponse.data,\n        isLoading: false,\n      }));\n\n    } catch (error) {\n      setAuthState(prev => ({\n        ...prev,\n        isLoading: false,\n        error: error instanceof Error ? error.message : 'Failed to load ad account data',\n      }));\n    }\n  };\n\n  // Select page\n  const selectPage = (page: FacebookPage): void => {\n    setAuthState(prev => ({\n      ...prev,\n      selectedPage: page,\n    }));\n  };\n\n  return {\n    ...authState,\n    apiClient,\n    login,\n    logout,\n    selectAdAccount,\n    selectPage,\n  };\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}